<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Threat Protector Dashboard</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="app">
    <!-- Sidebar - SIMPLIFIED -->
    <div class="sidebar">
      <h2>Threat Protector</h2>
      <div class="nav">
        <div class="nav-item active">Email Security</div>
        <div class="nav-item">Password Health</div>
      </div>
    </div>
    
    <!-- Email Security Tab Content -->
    <div class="dashboard-grid">

      <!-- Card 1: Email Scan Results (MAIN FOCUS) -->
      <div class="dashboard-card">
        <h2>Email Scan Results</h2>
        <div class="scan-stats">
          <div class="stat safe">Safe: <strong>47</strong></div>
          <div class="stat suspicious">Suspicious: <strong>3</strong></div>
          <div class="stat dangerous">Dangerous: <strong>2</strong></div>
        </div>
        <ul id="scan-results">
          <li>Loading emails...</li>
        </ul>
      </div>

      <!-- Card 2: Protection Summary (SIMPLIFIED) -->
      <div class="dashboard-card">
        <h2>Protection Summary</h2>
        <div class="protection-status">
          <p>Total Scanned: <strong id="scan-count">0</strong></p>
          <p>Threats Blocked: <strong id="phishing-count">0</strong></p>
          <p>Risk Level: <strong id="risk-level">--</strong></p>
          <p>Last Scan: <strong id="last-scan-time">Just now</strong></p>
        </div>
        <button class="scan-btn" onclick="loadEmailScanResults()">
          Scan Inbox Now
        </button>
      </div>

    </div>
  </div>

  <!-- JavaScript -->
  <script>
    async function loadEmailScanResults() {
      try {
        const res = await fetch('/scan?state=inbox:');
        const data = await res.json();

        const scanList = document.getElementById('scan-results');
        const scanCount = document.getElementById('scan-count');
        const phishingCount = document.getElementById('phishing-count');
        const riskLevel = document.getElementById('risk-level');
        const lastScan = document.getElementById('last-scan-time');

        scanList.innerHTML = '';
        let phishing = 0;

        data.forEach(email => {
          const li = document.createElement('li');
          li.className = `email-threat ${email.risk}`;
          
          li.innerHTML = `
            <div class="email-header">
              <span class="risk-badge ${email.risk}">${email.risk.toUpperCase()}</span>
              <strong>From:</strong> ${email.from}
            </div>
            <div class="email-subject">${email.subject}</div>
            <div class="threat-reason">ðŸš¨ ${getThreatReason(email)}</div>
          `;
          
          scanList.appendChild(li);
          if (email.status.includes("Phishing")) phishing++;
        });

        // Update stats
        scanCount.textContent = data.length;
        phishingCount.textContent = phishing;
        riskLevel.textContent = phishing >= 3 ? 'High' : phishing === 0 ? 'Low' : 'Medium';
        riskLevel.style.color = phishing >= 3 ? 'red' : phishing === 0 ? 'green' : 'orange';
        lastScan.textContent = new Date().toLocaleString();

      } catch (error) {
        console.error('Failed to fetch scan data:', error);
        document.getElementById('scan-results').innerHTML = '<li>Error loading scan results.</li>';
      }
    }

    // Explain WHY something is dangerous
    function getThreatReason(email) {
      if (email.from.includes('amaz0n') || email.from.includes('paypa1')) {
        return "Fake company domain (typosquatting)";
      }
      if (email.subject.toLowerCase().includes('urgent') && email.subject.toLowerCase().includes('password')) {
        return "Urgent password request - common phishing tactic";
      }
      if (email.from.includes('bit.ly') || email.from.includes('tinyurl')) {
        return "URL shortener - hides real destination";
      }
      return "Suspicious patterns detected";
    }

    window.addEventListener('load', loadEmailScanResults);
  </script>
</body>
</html>
